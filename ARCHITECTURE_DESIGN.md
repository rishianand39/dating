# Video Chat Application - Architecture Design

## ğŸ—ï¸ High-Level Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENT TIER                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Next.js Frontend (Port 3000)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   User A        â”‚  â”‚   User B        â”‚  â”‚   User C        â”‚  â”‚
â”‚  â”‚   Browser       â”‚  â”‚   Browser       â”‚  â”‚   Browser       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                     â”‚                     â”‚          â”‚
â”‚           â”‚  HTTP/WebSocket     â”‚                     â”‚          â”‚
â”‚           â”‚     Requests        â”‚                     â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚                     â”‚
            â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SERVER TIER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  NestJS Backend (Port 3000)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                WebSocket Gateway                             â”‚  â”‚
â”‚  â”‚  - User Connection Management                               â”‚  â”‚
â”‚  â”‚  - Room Management & Partner Matching                      â”‚  â”‚
â”‚  â”‚  - WebRTC Signaling (Offer/Answer/ICE)                    â”‚  â”‚
â”‚  â”‚  - Real-time Chat Messages                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                Video Chat Service                           â”‚  â”‚
â”‚  â”‚  - Room Creation & Management                               â”‚  â”‚
â”‚  â”‚  - User Matching Algorithm                                  â”‚  â”‚
â”‚  â”‚  - Waiting Queue Management                                 â”‚  â”‚
â”‚  â”‚  - Cleanup & Maintenance                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                HTTP REST Controller                         â”‚  â”‚
â”‚  â”‚  - Health Checks                                            â”‚  â”‚
â”‚  â”‚  - System Statistics                                        â”‚  â”‚
â”‚  â”‚  - Admin Operations                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚                     â”‚
            â”‚   WebRTC P2P        â”‚                     â”‚
            â”‚   Video/Audio       â”‚                     â”‚
            â”‚                     â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DATA TIER                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  In-Memory Storage                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    Rooms        â”‚  â”‚  User-Room      â”‚  â”‚  Waiting        â”‚  â”‚
â”‚  â”‚     Map         â”‚  â”‚    Mapping      â”‚  â”‚    Users        â”‚  â”‚
â”‚  â”‚  Map<id,Room>   â”‚  â”‚ Map<user,room>  â”‚  â”‚   Array[]       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ System Flow Diagram

```
User A Journey:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Opens     â”‚â”€â”€â”€â–¶â”‚   Connects to   â”‚â”€â”€â”€â–¶â”‚   Sends         â”‚
â”‚   Browser   â”‚    â”‚   WebSocket     â”‚    â”‚ find_partner    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                        â”‚
                           â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Assigned   â”‚â—€â”€â”€â”€â”‚   Server        â”‚â”€â”€â”€â–¶â”‚   Added to      â”‚
â”‚  User ID    â”‚    â”‚   Response      â”‚    â”‚ Waiting Queue   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User B Journey:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Opens     â”‚â”€â”€â”€â–¶â”‚   Connects to   â”‚â”€â”€â”€â–¶â”‚   Sends         â”‚
â”‚   Browser   â”‚    â”‚   WebSocket     â”‚    â”‚ find_partner    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                        â”‚
                           â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Assigned   â”‚â—€â”€â”€â”€â”‚   Server        â”‚â”€â”€â”€â–¶â”‚   Matched with  â”‚
â”‚  User ID    â”‚    â”‚   Response      â”‚    â”‚   User A        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                        â”‚
                           â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Both Users  â”‚â—€â”€â”€â”€â”‚   Room Created  â”‚â”€â”€â”€â–¶â”‚   WebRTC        â”‚
â”‚  Notified   â”‚    â”‚   with 2 Users  â”‚    â”‚  Signaling      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                           â”‚
       â–¼                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Video Call â”‚â—€â”€â”€â”€â”‚   Direct P2P    â”‚â—€â”€â”€â”€â”‚   ICE Exchange  â”‚
â”‚  Establishedâ”‚    â”‚   Connection    â”‚    â”‚   Complete      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ›ï¸ Component Architecture

### Frontend (Next.js Client)

```
client/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx                 # Root layout with metadata
â”‚   â”œâ”€â”€ page.tsx                   # Landing page with video chat link
â”‚   â”œâ”€â”€ globals.css                # Global styles
â”‚   â””â”€â”€ video-chat/
â”‚       â””â”€â”€ page.tsx               # Video chat page route
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ VideoChat.tsx              # Main video chat component
â”‚   â””â”€â”€ VideoChat.module.css       # Component-scoped styles
â””â”€â”€ hooks/
    â”œâ”€â”€ useWebSocket.ts            # WebSocket connection management
    â””â”€â”€ useWebRTC.ts               # WebRTC peer connection handling
```

**Component Hierarchy:**
```
App Layout
â”œâ”€â”€ Home Page
â”‚   â””â”€â”€ Link to Video Chat
â””â”€â”€ Video Chat Page
    â””â”€â”€ VideoChat Component
        â”œâ”€â”€ Video Streams (Local & Remote)
        â”œâ”€â”€ Control Buttons
        â”œâ”€â”€ Chat Interface
        â”œâ”€â”€ Status Display
        â”œâ”€â”€ useWebSocket Hook
        â””â”€â”€ useWebRTC Hook
```

### Backend (NestJS Server)

```
backend/src/
â”œâ”€â”€ app.module.ts                  # Root module with imports
â”œâ”€â”€ main.ts                        # Application bootstrap
â”œâ”€â”€ videochat/
â”‚   â”œâ”€â”€ video.module.ts            # Video chat module
â”‚   â”œâ”€â”€ video.gateway.ts           # WebSocket gateway
â”‚   â”œâ”€â”€ video.service.ts           # Business logic service
â”‚   â””â”€â”€ video.controller.ts        # HTTP REST controller
â””â”€â”€ auth/                          # Authentication module
    â”œâ”€â”€ auth.module.ts
    â”œâ”€â”€ auth.service.ts
    â””â”€â”€ auth.controller.ts
```

**Module Dependencies:**
```
AppModule
â”œâ”€â”€ AuthModule
â”‚   â”œâ”€â”€ AuthController
â”‚   â””â”€â”€ AuthService
â”œâ”€â”€ VideoChatModule
â”‚   â”œâ”€â”€ VideoChatGateway (WebSocket)
â”‚   â”œâ”€â”€ VideoChatService (Business Logic)
â”‚   â””â”€â”€ VideoChatController (HTTP)
â””â”€â”€ PrismaService (Database)
```

## ğŸ”„ Data Flow Architecture

### WebSocket Communication Flow

```
Client                    Gateway                   Service
  â”‚                         â”‚                         â”‚
  â”‚â”€â”€â”€â”€ find_partner â”€â”€â”€â”€â”€â”€â–¶â”‚                         â”‚
  â”‚                         â”‚â”€â”€â”€ findOrCreateRoom â”€â”€â”€â–¶â”‚
  â”‚                         â”‚â—€â”€â”€ Room object â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚â—€â”€â”€ waiting_for_partner â”€â”‚                         â”‚
  â”‚                         â”‚                         â”‚
  â”‚â”€â”€â”€â”€ webrtc_offer â”€â”€â”€â”€â”€â”€â–¶â”‚                         â”‚
  â”‚                         â”‚â”€â”€â”€ forwardToPartner â”€â”€â”€â–¶â”‚
  â”‚                         â”‚                         â”‚
  â”‚â—€â”€â”€â”€ webrtc_answer â”€â”€â”€â”€â”€â”‚â—€â”€â”€â”€ partner response â”€â”€â”€â”‚
  â”‚                         â”‚                         â”‚
  â”‚â”€â”€â”€â”€ chat_message â”€â”€â”€â”€â”€â”€â–¶â”‚                         â”‚
  â”‚                         â”‚â”€â”€â”€ forwardToPartner â”€â”€â”€â–¶â”‚
```

### Room Management Data Flow

```
User State Transitions:

1. DISCONNECTED
   â”‚
   â–¼ (connect WebSocket)
   â”‚
2. CONNECTED
   â”‚
   â–¼ (send find_partner)
   â”‚
3. WAITING â”€â”€â”€â”€â”€â”€â”
   â”‚             â”‚
   â–¼ (partner    â”‚ (timeout/leave)
   â”‚  found)     â”‚
   â”‚             â–¼
4. MATCHED â—€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼ (WebRTC established)
   â”‚
5. IN_CALL
   â”‚
   â–¼ (next_partner/disconnect)
   â”‚
6. DISCONNECTED
```

### Memory Storage Architecture

```
VideoChatService Data Structures:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     rooms: Map          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ "room-123" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”‚
â”‚  â”‚   â”œâ”€ id: "room-123" â”‚â”‚
â”‚  â”‚   â”œâ”€ users: ["A","B"]â”‚â”‚
â”‚  â”‚   â”œâ”€ createdAt: Date â”‚â”‚
â”‚  â”‚   â””â”€ isActive: true  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   userRoomMap: Map      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ "user-A" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚â”‚
â”‚  â”‚ "room-123"          â”‚â”‚
â”‚  â”‚ "user-B" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚â”‚
â”‚  â”‚ "room-123"          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   waitingUsers: Array   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ [                   â”‚â”‚
â”‚  â”‚   {                 â”‚â”‚
â”‚  â”‚     userId: "C",    â”‚â”‚
â”‚  â”‚     joinedAt: Date  â”‚â”‚
â”‚  â”‚   }                 â”‚â”‚
â”‚  â”‚ ]                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸŒ Network Architecture

### Communication Protocols

```
Protocol Stack:

Application Layer:
â”œâ”€â”€ HTTP REST API (Admin/Monitoring)
â”œâ”€â”€ WebSocket (Real-time Signaling)
â””â”€â”€ WebRTC (Direct P2P Media)

Transport Layer:
â”œâ”€â”€ TCP (HTTP/WebSocket)
â””â”€â”€ UDP (WebRTC Media)

Network Layer:
â”œâ”€â”€ IPv4/IPv6
â””â”€â”€ STUN/TURN (NAT Traversal)
```

### WebRTC Signaling Sequence

```
User A                Gateway               User B
  â”‚                     â”‚                     â”‚
  â”‚â”€â”€â”€ offer â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚
  â”‚                     â”‚â”€â”€â”€ offer â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                     â”‚                     â”‚
  â”‚                     â”‚â—€â”€â”€ answer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚â—€â”€â”€ answer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚
  â”‚                     â”‚                     â”‚
  â”‚â”€â”€â”€ ICE candidate â”€â”€â–¶â”‚                     â”‚
  â”‚                     â”‚â”€â”€â”€ ICE candidate â”€â”€â–¶â”‚
  â”‚                     â”‚                     â”‚
  â”‚â—€â”€â”€ ICE candidate â”€â”€â”€â”‚â—€â”€â”€ ICE candidate â”€â”€â”€â”‚
  â”‚                     â”‚                     â”‚
  â”‚â•â•â•â•â•â•â•â•â•â•â• Direct P2P Connection â•â•â•â•â•â•â•â”‚
  â”‚          (Video/Audio Streams)           â”‚
```

## ğŸ”§ Technical Architecture

### Technology Stack

```
Frontend:
â”œâ”€â”€ Next.js 14 (React Framework)
â”œâ”€â”€ React 18 (UI Library)
â”œâ”€â”€ TypeScript (Type Safety)
â”œâ”€â”€ CSS Modules (Styling)
â”œâ”€â”€ WebRTC APIs (Media)
â””â”€â”€ WebSocket API (Real-time)

Backend:
â”œâ”€â”€ NestJS (Node.js Framework)
â”œâ”€â”€ TypeScript (Type Safety)
â”œâ”€â”€ WebSocket/ws (Real-time)
â”œâ”€â”€ UUID (User Identification)
â””â”€â”€ Express (HTTP Server)

Protocols:
â”œâ”€â”€ HTTP/HTTPS (REST API)
â”œâ”€â”€ WebSocket/WSS (Signaling)
â”œâ”€â”€ WebRTC (Media Streaming)
â””â”€â”€ STUN (NAT Traversal)
```

### Security Architecture

```
Security Layers:

1. Transport Security:
   â”œâ”€â”€ HTTPS (Production)
   â”œâ”€â”€ WSS (Secure WebSocket)
   â””â”€â”€ SRTP (Secure RTP for WebRTC)

2. Application Security:
   â”œâ”€â”€ CORS Configuration
   â”œâ”€â”€ Input Validation
   â”œâ”€â”€ Rate Limiting (Future)
   â””â”€â”€ Authentication (Future)

3. Network Security:
   â”œâ”€â”€ Firewall Rules
   â”œâ”€â”€ STUN Server Security
   â””â”€â”€ NAT Traversal
```

## ğŸ“Š Scalability Architecture

### Current Architecture (Single Instance)

```
Single Server Instance:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      NestJS Server      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   WebSocket         â”‚â”‚
â”‚  â”‚   Gateway           â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚ In-Memory       â”‚â”‚â”‚
â”‚  â”‚  â”‚ Storage         â”‚â”‚â”‚
â”‚  â”‚  â”‚ â”œâ”€ Rooms        â”‚â”‚â”‚
â”‚  â”‚  â”‚ â”œâ”€ Users        â”‚â”‚â”‚
â”‚  â”‚  â”‚ â””â”€ Waiting      â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scalable Architecture (Future)

```
Multi-Instance with Redis:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Instance 1    â”‚  â”‚   Instance 2    â”‚  â”‚   Instance 3    â”‚
â”‚   (WebSocket)   â”‚  â”‚   (WebSocket)   â”‚  â”‚   (WebSocket)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                    â”‚                    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚            Redis Cluster                â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
          â”‚  â”‚        Shared State:               â”‚â”‚
          â”‚  â”‚  â”œâ”€ Rooms                         â”‚â”‚
          â”‚  â”‚  â”œâ”€ User Sessions                 â”‚â”‚
          â”‚  â”‚  â”œâ”€ Waiting Queue                 â”‚â”‚
          â”‚  â”‚  â””â”€ Pub/Sub Messaging             â”‚â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Deployment Architecture

### Development Environment

```
Local Development:
â”œâ”€â”€ Backend: localhost:3000
â”œâ”€â”€ Frontend: localhost:3000 (Next.js dev)
â”œâ”€â”€ WebSocket: localhost:3000
â””â”€â”€ Database: In-memory
```

### Production Environment (Recommended)

```
Production Stack:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Load Balancer              â”‚
â”‚           (Nginx/CloudFlare)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”           â”Œâ”€â”€â”€â–¼â”€â”€â”€â”
â”‚ App 1 â”‚           â”‚ App 2 â”‚
â”‚(Stickyâ”‚           â”‚Sessionâ”‚
â”‚Sessionâ”‚           â”‚)      â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜           â””â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Redis Cluster   â”‚
    â”‚ (Session Storage) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ Performance Architecture

### Connection Management

```
Connection Lifecycle:
1. WebSocket Connection: ~1ms
2. User ID Assignment: ~1ms  
3. Partner Matching: ~5ms
4. WebRTC Negotiation: ~200-500ms
5. Media Stream: ~100-300ms
Total Connection Time: ~300-800ms
```

### Memory Usage Estimation

```
Per User Memory:
â”œâ”€â”€ WebSocket Connection: ~8KB
â”œâ”€â”€ User Object: ~1KB
â”œâ”€â”€ Room Object: ~2KB (shared)
â””â”€â”€ Waiting Queue Entry: ~0.5KB

Concurrent Users Capacity:
â”œâ”€â”€ 1000 users: ~11MB
â”œâ”€â”€ 10000 users: ~110MB
â”œâ”€â”€ 100000 users: ~1.1GB
```

### Bottlenecks & Solutions

```
Potential Bottlenecks:
1. WebSocket Connections
   â””â”€ Solution: Horizontal scaling + Redis

2. Memory Usage (In-memory storage)
   â””â”€ Solution: Redis external storage

3. CPU Usage (WebRTC signaling)
   â””â”€ Solution: Load balancing

4. Network Bandwidth
   â””â”€ Solution: CDN + Regional servers
```

This architecture design provides a solid foundation for an Omegle-like video chat application with clear separation of concerns, scalability considerations, and modern web technologies. The modular design allows for easy maintenance and future enhancements.
